<div class="container">
    <h1 class="mt-3">Product List</h1>

    <div class="d-flex align-items-center mb-3">
        <button class="btn btn-primary me-3" (click)="showAddProduct()">Add Product</button>

        <!-- Input để cấu hình số lượng sản phẩm hiển thị trên mỗi trang -->
        <label for="itemsPerPage" class="me-2">Items per page:</label>
        <input id="itemsPerPage" type="number" [(ngModel)]="pageSize" class="form-control" style="width: 100px;" min="1"
            max="100" (change)="onItemsPerPageChange()" />
    </div>

    <div class="mt-3">
        <ng-container *ngIf="page$ | async as page; else loading">
            <table class="table table-bordered mt-3">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Product Name</th>
                        <th>Image</th>
                        <th>Is Active</th>
                        <th>Brand</th>
                        <th>Specifications</th>
                        <th>CreatedAt</th>
                        <th>UpdatedAt</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let product of page.items; trackBy: trackByProductId">
                        <td>P0{{ product.productId }}</td>
                        <td>{{ product.name }}</td>
                        <td>
                            <img [src]="product.imageUrl" alt="Product Image" class="img-thumbnail"
                                style="max-width: 100px; max-height: 100px;" />
                        </td>
                        <td>
                            <span [class.text-success]="product.isActive" [class.text-danger]="!product.isActive">
                                {{ product.isActive ? 'Active' : 'Inactive' }}
                            </span>
                        </td>
                        <td>{{ product.brand.name || 'N/A' }}</td>
                        <td>
                            <ul>
                                <li *ngFor="let spec of product.productSpecifications">
                                    {{ spec.specificationType.name }}: {{ spec.value }}
                                </li>
                            </ul>
                        </td>
                        <td>{{ product.createdAt | date:'short' }}</td>
                        <td>{{ product.updatedAt | date:'short' }}</td>
                        <td>
                            <a (click)="updateProduct(product.productId)" class="link-update">Update</a>
                            <a (click)="onDeleteProduct(product.productId, product.isActive)"
                                class="link-delete">Delete</a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </ng-container>
        <ng-template #loading>
            <div class="loading">Loading...</div>
        </ng-template>
    </div>
    <div class="pagination">
        <button (click)="previousPage()" [disabled]="page === 1">Previous</button>
        <span *ngIf="1 != page">{{ 1 }}</span>
        <span *ngIf="page > 2">...</span>
        <span class="active">{{ page }}</span>
        <span *ngIf="page + 1 < totalPages">...</span>
        <span *ngIf="totalPages != page">{{ totalPages }}</span>
        <button (click)="nextPage()" [disabled]="page === totalPages">Next</button>
    </div>
    <div *ngIf="isAddProductVisible" class="overlay" (click)="hideAddProduct()"></div>

    <div *ngIf="isAddProductVisible" class="modal-container">
        <app-add-or-update-product [productToUpdate]="productToUpdate" (close)="hideAddProduct()"
            (add)="onAddProduct($event)">
        </app-add-or-update-product>
    </div>
</div>